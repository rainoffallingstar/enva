---
description:代码审查 (Plan Mode）
---
# 代码审查 (Plan Mode)

> **执行模式**: 请在 **Plan 模式** 下执行此审查，先分析再行动。

------------------------------------------------------------------------

## 🎯 审查范围

请选择一项或直接描述：

| 方式         | 示例                                                    |
|--------------|---------------------------------------------------------|
| 特定文件     | `src/utils/auth.ts`                                     |
| 特定模块     | `src/payment/`                                          |
| 最近修改     | `recent` 或 `git diff HEAD~1`                           |
| **功能描述** | `用户登录流程` `支付模块的退款功能` `WebSocket消息推送` |

**当前输入**: `$ARGUMENTS`

------------------------------------------------------------------------

## 📋 审查流程

### Phase 1: 解析范围 & 收集上下文

**若输入为功能描述，请执行：** 1. 分析功能描述，理解用户意图 2. 在
`docs/architecture.md` 中定位相关模块/数据流 3.
通过以下方式确定关联文件： - 搜索相关关键词（函数名、类名、路由） -
追踪数据流涉及的模块 - 检查 `active_context.md` 中的相关记录 4.
**列出待审查文件清单，请求用户确认后再继续**

**标准上下文收集：** - 读取 `docs/architecture.md` 了解数据流设计 - 读取
`docs/active_context.md` 了解当前状态 - 读取 `src/types/`
目录了解类型定义

### Phase 2: 执行检查

| 类别       | 检查项                                                   |
|------------|----------------------------------------------------------|
| **数据流** | 符合架构设计 · 使用定义好的 Interface · 无断裂           |
| **类型**   | 无 `any` · 无隐式推断 · 参数/返回值完整 · 跨模块类型连贯 |
| **API**    | 返回 `ApiResponse<T>` · 错误码在枚举中 · 异常处理完善    |
| **安全**   | 敏感数据处理 · 输入验证 · 权限检查 · 无注入风险          |
| **质量**   | 命名规范 · 无重复代码 · 注释充分 · 边界处理              |
| **文档**   | `active_context.md` 同步 · 新方法/类型已记录             |

------------------------------------------------------------------------

## 📤 输出规范

### 范围解析结果（功能描述时输出）

```         
═══════════════════════════════════
        范围解析结果
═══════════════════════════════════
🎯 功能描述: 用户登录流程
📁 关联文件:
   - src/auth/login.controller.ts
   - src/auth/login.service.ts
   - src/auth/strategies/jwt.strategy.ts
   - src/types/auth.interface.ts
   - src/middleware/auth.guard.ts
🔗 数据流: Client → AuthController → AuthService → UserRepository → JWT
═══════════════════════════════════
请确认审查范围 (y/n/调整):
```

### 问题报告格式

```         
[🔴高 | 🟡中 | 🟢低] <问题类型>
📁 文件: path/to/file.ts (L42-56)

问题: <简述>
建议: <修复方案>
```

### 审查摘要

```         
═══════════════════════════════════
        代码审查报告
═══════════════════════════════════
🎯 审查范围: <原始输入>
📁 审查文件: X 个
🔍 发现问题: X 个 (🔴X 🟡X 🟢X)
📊 类型覆盖: X%
📝 文档同步: ✅ 已同步 / ❌ 需更新
═══════════════════════════════════
```

------------------------------------------------------------------------

## ⚡ 使用示例

``` bash
# 精确路径
/review-code src/auth/login.service.ts

# 模块目录
/review-code src/payment/

# 最近变更
/review-code recent

# 功能描述（智能解析）
/review-code 用户登录流程
/review-code 订单创建到支付完成的完整链路
/review-code WebSocket 实时消息推送功能
/review-code 最近做的文件上传功能
```

